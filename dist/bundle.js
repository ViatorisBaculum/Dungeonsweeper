(()=>{"use strict";const e={typeDistribution:{Rat:.4,Zombie:.3,Skeleton:.1,Ghost:.1,Witch:.1,Boss:0},expToNextLevel:[100,200,300,400],boardDefaults:{width:40,height:20,minesFrequency:.3,evolutionRate:.2,invertClicks:!1,removeFlags:!1},playerClass:"Warrior",monsterKeys:{0:"E",1:"R¬π",2:"Z¬≤",3:"S¬≥",4:"G‚Å¥",5:"W‚Åµ",6:"B‚Å∂"},experienceGain:{open:1,multiplicator:3}};class t{constructor(){this._experience=0,this._health=0,this.maxHealth=0,this._level=1,this._score=0,this.heartContainers=[],this._HTMLHooks=this.loadHTMLHooks()}set experience(e){this._experience=e,this.gainLevel(),this.updateStatsheet()}get experience(){return this._experience}set health(e){this._health=e,this._health<=0&&c.getInstance().loseGame(),this.updateStatsheet()}get health(){return this._health}set level(e){this._level=e,this.updateStatsheet()}get level(){return this._level}set score(e){this._score=e,this.updateStatsheet()}get score(){return this._score}calculateScore(e){this.score=this.experience-e,this.score<0&&(this.score=0)}getAttacked(e){this.health-=e}gainExperience(e){this.experience+=e,console.log("exp",this.experience)}debugSetExperience(e){if(e<0)throw new Error("Experience cannot be negative");this.experience=e}debugGainLevel(){this.level<=4&&(this.level+=1),this.experience=e.expToNextLevel[this.level-1],this.updateStatsheet(),c.getInstance().playerUp()}gainLevel(){this.experience>e.expToNextLevel[this.level-1]&&(this.level+=1,c.getInstance().playerUp(),"Warrior"===this.className&&this.gainHealth())}gainHealth(){this.health<this.maxHealth&&(this.health+=1,this.styleHearts())}importHTMLElement(e){const t=document.getElementById(e);if(!t)throw new Error("No html element with id: "+e);return t}importHTMLProgressElement(e){const t=document.getElementById(e);if(!t)throw new Error("No html element with id: "+e);return t}loadHTMLHooks(){return{playerClassSpan:this.importHTMLElement("playerClass"),playerExperienceProgress:this.importHTMLProgressElement("experience"),playerHealthDiv:this.importHTMLElement("health"),playerLevelDiv:this.importHTMLElement("playerLevel"),playerScoreDiv:this.importHTMLElement("score")}}updateStatsheet(){this._HTMLHooks.playerClassSpan.innerText=this.className,this._HTMLHooks.playerLevelDiv.innerText=this._level.toString(),0===this.heartContainers.length&&this.addHearts(),this.styleHearts(),this.updateProgress(),this._HTMLHooks.playerScoreDiv.innerText="Score: "+this._score.toString()}addHearts(){for(let e=0;e<this.maxHealth;e++){const e=document.createElement("img");e.src="./res/heart.svg",e.alt="Health",e.classList.add("heart"),this.heartContainers.push(e),this._HTMLHooks.playerHealthDiv.appendChild(e)}}styleHearts(){this.heartContainers.forEach(((e,t)=>{t>=this.health?e.classList.add("colored"):e.classList.remove("colored")}))}updateProgress(){if(this._level<5){const t=this._level>1?e.expToNextLevel[this.level-2]:0;this._HTMLHooks.playerExperienceProgress.max=e.expToNextLevel[this.level-1]-t,this._HTMLHooks.playerExperienceProgress.value=this._experience-t}}}class s extends t{constructor(e){super(),this.className="Assassin",this.health=2,this.maxHealth=this.health}}var i,a;!function(e){e[e.Empty=0]="Empty",e[e.Rat=1]="Rat",e[e.Zombie=2]="Zombie",e[e.Skeleton=3]="Skeleton",e[e.Ghost=4]="Ghost",e[e.Witch=5]="Witch",e[e.Boss=6]="Boss"}(i||(i={}));class l extends t{constructor(e){if(super(),this.className="Mage",this.fireballAvailable=!0,this.isFireballModeActive=!1,!e)throw new Error("PC_Mage requires a Board instance during construction.");this.health=2,this.maxHealth=this.health,this.board=e}canCastFireball(){return this.fireballAvailable}consumeFireballCharge(){this.fireballAvailable=!1}resetFireball(){this.fireballAvailable=!0,C()}activateFireballMode(){return!!this.canCastFireball()&&(this.isFireballModeActive=!0,document.body.classList.add("fireball-mode-active"),C(),!0)}deactivateFireballMode(){this.isFireballModeActive=!1,document.body.classList.remove("fireball-mode-active"),C()}castFireballOnCell(e,t){if(this.isFireballModeActive){for(let s=-1;s<=1;s++)for(let a=-1;a<=1;a++){const l=this.board.getCell(e+s,t+a);l&&!l.isClicked&&l.type===i.Empty&&l.click(0)}this.consumeFireballCharge(),this.deactivateFireballMode()}}}class n extends t{constructor(e){super(),this.className="Paladin",this.health=4,this.maxHealth=this.health}}class r extends t{constructor(e){super(),this.className="Warrior",this.health=3,this.maxHealth=this.health}}class o{constructor(e,t,s,i,a,l,n){this.isClicked=!1,this.isFlagged=!1,this.type=e,this.board=t,this.x=s,this.y=i,this.HTMLElement=a,this.gameInstance=l,this.value=n}activateCell(e){this.revealCell(),this.addExperience(e)}addExperience(e){this.gameInstance.player.gainExperience(e)}attackPlayer(t){this.type!==i.Empty&&(console.log("Monster attack! Type:",this.type,"at",this.x,this.y),"Assassin"===this.gameInstance.player.className&&this.type===i.Boss&&void 0===t&&(t=1),t||0===t||(t=this.type-this.gameInstance.player.level+1),t>0&&this.gameInstance.player.getAttacked(t),this.addExperience(this.type*e.experienceGain.multiplicator),this.gameInstance.player.health>0&&this.type===i.Boss&&this.gameInstance.winGame())}click(t){this.isClicked||this.isFlagged||(void 0!==this.value&&this.activateCell(e.experienceGain.open),0===this.value&&this.type===i.Empty&&this.clickNeighbors(t),this.type>0&&void 0===this.value&&(this.attackPlayer(t),this.activateCell(0)))}getBlankNeighbors(){let e=[];const{x:t,y:s,board:i}=this;for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++){const n=i.getCell(t+a,s+l);n&&0===n.value&&e.push(n)}return e}clickNeighbors(t){const{x:s,y:a,board:l}=this,n=[];for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++){const i=l.getCell(s+e,a+t);i&&!i.isClicked&&n.push(i)}const r=n.filter((e=>!e.isFlagged));for(const s of r)0===s.value?s.click(t):s.type===i.Empty?s.activateCell(e.experienceGain.open):s.type>i.Empty&&s.click(t)}isAnyNeighborClicked(){const{x:e,y:t,board:s}=this;for(let i=-1;i<=1;i++)for(let a=-1;a<=1;a++){const l=s.getCell(e+i,t+a);if(l&&l.isClicked)return!0}return!1}revealCell(){if(!this.isClicked)if(this.isClicked=!0,this.animateReveal(),this.HTMLElement.classList.add("clicked"),this.value)this.HTMLElement.innerText=this.value.toString();else if(!this.value&&this.type>0){this.HTMLElement.innerText=this.translateType(this.type);const e=this.translateType(this.type).replace(/[^a-zA-Z0-9_-]/g,"");this.HTMLElement.classList.add("monster",e)}else this.HTMLElement.innerText=""}rightClick(e){e.preventDefault(),"Assassin"!==this.gameInstance.player.className?this.isClicked?this.clickNeighbors():(this.isFlagged=!this.isFlagged,this.toggleFlag()):this.rightClickAssassin(e)}rightClickAssassin(e){e.preventDefault(),this.isClicked?this.clickNeighbors():(this.activateCell(0),this.gameInstance.player.level===this.type||this.type+this.gameInstance.player.level===11?this.attackPlayer(0):this.gameInstance.player.level<this.type?this.attackPlayer():this.attackPlayer(1))}translateType(t){return t>0&&void 0!==e.monsterKeys[t]?e.monsterKeys[t]:t===i.Empty?".":"?"}toggleFlag(){this.isFlagged?(this.HTMLElement.innerHTML="üíÄ",this.HTMLElement.classList.add("flagged")):(this.HTMLElement.innerHTML="",this.HTMLElement.classList.remove("flagged"))}animateReveal(){this.HTMLElement.checkVisibility()&&(this.HTMLElement.classList.remove("shrinked"),this.HTMLElement.classList.add("shrinked"))}}class h{constructor(t,s,i,a,l=e.typeDistribution){this.cells=[],this.validateDistribution(l),this.gameInstance=a,this._minesFrequency=i,this._width=t,this._height=s;const n=document.getElementById("app");if(!n)throw new Error("board: No #app div found");this.appElement=n,this.fillBoard(l),this.determineCellValues(),this.debug_printCellValues(),this.updateCSSVariables(t,s),this.debug_writeValues(!1),this.clickHandler=this.createClickHandler(),this.contextMenuHandler=this.createContextMenuHandler(),this.addBoardEventHandlers(),this.indicateLevelGain(1)}evoluteMonster(){this.getRemainingMonster().forEach((t=>{Math.random()<=e.boardDefaults.evolutionRate&&t.type<i.Witch&&(t.type+=1)})),this.determineCellValues(),this.debug_printCellValues()}getCell(e,t){return this.cells[e]&&this.cells[e][t]?this.cells[e][t]:void 0}getCellType(e,t){return this.getCell(e,t)?this.cells[e][t].type:i.Empty}indicateLevelGain(e){if(this.appElement){for(let e=1;e<=5;e++)this.appElement.classList.remove(`level-${e}`);this.appElement.classList.add(`level-${e}`),this.appElement.classList.remove("highlight"),this.appElement.offsetWidth,this.appElement.classList.add("highlight")}}openStartArea(){let e=Math.floor(Math.random()*(this._height-1)),t=Math.floor(Math.random()*(this._width-1)),s=this.cells[e][t];for(;0!==s.value;)e=Math.round(Math.random()*(this._height-1)),t=Math.round(Math.random()*(this._width-1)),s=this.cells[e][t];s.click(),s.HTMLElement.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}removeEventHandler(){this.appElement.removeEventListener("click",this.clickHandler),this.appElement.removeEventListener("contextmenu",this.contextMenuHandler)}removeAllFlags(){this.cells.flat().forEach((e=>{e.isFlagged&&(e.isFlagged=!1,e.toggleFlag())}))}revealBoard(){this.cells.flat().forEach((e=>{e.isClicked||(e.HTMLElement.classList.add("notClicked"),e.revealCell(),e.isFlagged&&(e.isFlagged=!1))}))}createUrn(e){const t=this._width*this._height,s=this._minesFrequency*t,a=t*(1-this._minesFrequency),l=new Array(t).fill(i.Empty,0,a-1);l.fill(i.Boss,a-1,a);const n=a+e.Rat*s,r=n+e.Zombie*s,o=r+e.Skeleton*s,h=o+e.Ghost*s,c=h+e.Witch*s,d=c+e.Boss*s;l.fill(i.Rat,a,n),l.fill(i.Zombie,n,r),l.fill(i.Skeleton,r,o),l.fill(i.Ghost,o,h),l.fill(i.Witch,h,c),l.fill(i.Boss,c,d);for(let e=l.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[l[e],l[t]]=[l[t],l[e]]}return l}determineCellValues(){this.cells.forEach(((e,t)=>{e.forEach(((e,s)=>{if(e.type===i.Empty){let i=0;i+=this.getCellType(t-1,s-1),i+=this.getCellType(t-1,s+0),i+=this.getCellType(t-1,s+1),i+=this.getCellType(t+0,s-1),i+=this.getCellType(t+0,s+1),i+=this.getCellType(t+1,s-1),i+=this.getCellType(t+1,s+0),i+=this.getCellType(t+1,s+1),e.value=i}}))}))}fillBoard(e){var t;const s=this.createUrn(e),a=document.createDocumentFragment();for(let e=0;e<this._height;e++){this.cells.push([]);for(let l=0;l<this._width;l++){const n=document.createElement("button");n.dataset.x=e.toString(),n.dataset.y=l.toString();const r=new o(null!==(t=s.pop())&&void 0!==t?t:i.Empty,this,e,l,n,this.gameInstance,void 0);a.appendChild(n),this.cells[e].push(r)}}this.appElement.appendChild(a)}getRemainingMonster(){let e=[];return this.cells.forEach((t=>{t.forEach((t=>{!t.isAnyNeighborClicked()&&t.type>i.Empty&&!t.isClicked&&e.push(t)}))})),e}updateCSSVariables(e,t){const s=document.querySelector(":root");if(!s)throw new Error("No :root found");s.style.setProperty("--cols",e.toString()),s.style.setProperty("--rows",t.toString())}validateDistribution(e){let t=0;for(const[s,i]of Object.entries(e))t+=i;if(Math.abs(t-1)<1e-6)return!0;throw new Error("Provided typeDistribution doesn't sum to 1. Sum of proportions is "+t)}createClickHandler(){return e=>{const t=e.target;if(!t||!t.dataset.x||!t.dataset.y)return;const s=Number(t.dataset.x),i=Number(t.dataset.y),a=this.getCell(s,i);if(!a)return;const l=c.getInstance().player;if("Mage"===l.className){const t=l;if(t.isFireballModeActive)return e.preventDefault(),e.stopPropagation(),void t.castFireballOnCell(s,i)}a.gameInstance.invertClicks?a.rightClick(e):a.click()}}createContextMenuHandler(){return e=>{const t=e.target;if(!t||!t.dataset.x||!t.dataset.y)return;e.preventDefault();const s=Number(t.dataset.x),i=Number(t.dataset.y),a=this.getCell(s,i);a&&(a.gameInstance.invertClicks?a.click():a.rightClick(e))}}addBoardEventHandlers(){this.appElement.addEventListener("click",this.clickHandler),this.appElement.addEventListener("contextmenu",this.contextMenuHandler)}debug_printCellValues(){let e="";e+="    ";for(let t=0;t<this._width;t++)e+=t.toString().padStart(3," ");e+="\n",this.cells.forEach(((t,s)=>{let a=s.toString().padStart(3," ")+" ";t.forEach((e=>{let t=e.type===i.Empty?void 0!==e.value?e.value.toString():".":e.translateType(e.type);a+=t.toString().padStart(3," ")})),e+=a+"\n"})),console.log(e)}debug_writeValues(e){!0===e&&this.cells.forEach((e=>{e.forEach((e=>{e.type&&(e.HTMLElement.innerText=e.translateType(e.type))}))}))}}!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Paused=2]="Paused",e[e.Ended=3]="Ended"}(a||(a={}));class c{constructor(){var e;this._gameTimer=0,this._gameState=a.NotStarted,this.playerClassRegistry={Assassin:s,Mage:l,Paladin:n,Warrior:r},null===(e=document.getElementById("resetButton"))||void 0===e||e.addEventListener("click",(()=>this.resetGame())),this._gameSettings=this.initializeGameSettings(),this.populateSettingsUIFromGameSettings()}static getInstance(){return c.instance||(c.instance=new c),c.instance}set board(e){this._board=e}get board(){if(!this._board)throw new Error("Board was not initialized!");return this._board}set player(e){this._player=e}get player(){if(!this._player)throw new Error("Player was not initialized!");return this._player}get timer(){if(this._timer)return this._timer}get invertClicks(){return this._gameSettings.invertClicks}get removeFlags(){return this._gameSettings.removeFlags}createBoard(){this.board=new h(this._gameSettings.width,this._gameSettings.height,this._gameSettings.minesFrequency,this)}createPlayer(){const e=this.playerClassRegistry[this._gameSettings.playerClass];if(e)if("Mage"===this._gameSettings.playerClass){if(!this._board)throw new Error("Board must be initialized before creating a Mage player.");this.player=new e(this._board)}else this.player=new e(void 0);else console.error(`Unknown player class: ${this._gameSettings.playerClass}. Defaulting to Warrior.`),this.player=new r(void 0)}loadDefaultSettings(){return{width:e.boardDefaults.width,height:e.boardDefaults.height,minesFrequency:e.boardDefaults.minesFrequency,playerClass:e.playerClass,invertClicks:e.boardDefaults.invertClicks,removeFlags:e.boardDefaults.removeFlags}}initializeGameSettings(){const e=this.loadDefaultSettings(),t=localStorage.getItem("instance");if(t)try{const s=JSON.parse(t);return Object.assign(Object.assign(Object.assign({},e),s),{width:void 0!==s.width?+s.width:e.width,height:void 0!==s.height?+s.height:e.height,minesFrequency:void 0!==s.minesFrequency?+s.minesFrequency:e.minesFrequency,playerClass:s.playerClass||e.playerClass,invertClicks:"boolean"==typeof s.invertClicks?s.invertClicks:e.invertClicks,removeFlags:"boolean"==typeof s.removeFlags?s.removeFlags:e.removeFlags})}catch(t){return console.error("Failed to parse stored settings, using defaults and removing corrupted item.",t),localStorage.removeItem("instance"),e}return e}playerUp(){this.board.indicateLevelGain(this.player.level),this.board.evoluteMonster(),this._gameSettings.removeFlags&&this.board.removeAllFlags(),"Mage"===this.player.className&&this.player.resetFireball()}resetGame(){this._gameState!==a.Running&&this._gameState!==a.Paused||this.stopTimer(),this._board&&this._board.removeEventHandler(),this._gameState=a.NotStarted;const e=document.getElementById("app");e&&(e.innerHTML=""),this.resetHeartContainer(),this.startGame(),C()}saveSettingsFromUI(){try{this._gameSettings.width=+this.getValueFromInput("inputWidth"),this._gameSettings.height=+this.getValueFromInput("inputHeight"),this._gameSettings.minesFrequency=+this.getValueFromInput("minesFrequency"),this._gameSettings.playerClass=this.getValueFromInput("selectClass"),this._gameSettings.invertClicks=this.getCheckedFromToggle("invertClicks"),this._gameSettings.removeFlags=this.getCheckedFromToggle("removeFlags"),localStorage.setItem("instance",JSON.stringify(this._gameSettings))}catch(e){console.error("Error saving settings from UI:",e)}}startGame(){var e;document.getElementById("modal")&&this.saveSettingsFromUI(),document.getElementById("modal")&&this.getScores(),this.createBoard(),this.createPlayer(),null===(e=this._board)||void 0===e||e.openStartArea(),this.resetTimer(),this._timer=setInterval((()=>this.countSeconds()),1e3),this._gameState=a.Running}winGame(){this.endGame(),this.updateLeaderboard(this.player.score),this.displayLeaderboard(`You won! Score: ${this.player.score}`)}loseGame(){this.endGame(),this.displayLeaderboard("You lost!")}pauseTimer(){this._timer&&this._gameState===a.Running&&(clearInterval(this._timer),this._timer=void 0,this._gameState=a.Paused)}resumeTimer(){this._gameState===a.Paused&&(this._timer=setInterval((()=>this.countSeconds()),1e3),this._gameState=a.Running)}updateLeaderboard(e){const t="leaderboard",s=JSON.parse(localStorage.getItem(t)||"[]");s.push(e),s.sort(((e,t)=>t-e));const i=s.slice(0,10);localStorage.setItem(t,JSON.stringify(i))}getScores(){return JSON.parse(localStorage.getItem("leaderboard")||"[]")}displayLeaderboard(e){S(e)}isGameEnded(){return this._gameState===a.Ended}countSeconds(){this._gameTimer++,this.player.calculateScore(this._gameTimer)}endGame(){this.stopTimer(),this.board.revealBoard(),this.board.removeEventHandler(),this._gameState=a.Ended}getValueFromInput(e){const t=document.getElementById(e);if(t)return t.value;throw new Error(`HTML input element with id '${e}' not found.`)}getCheckedFromToggle(e){const t=document.getElementById(e);if(t)return t.checked;throw new Error(`HTML input (checkbox/toggle) element with id '${e}' not found.`)}populateSettingsUIFromGameSettings(){this.trySetInputValue("inputWidth",this._gameSettings.width.toString()),this.trySetInputValue("inputHeight",this._gameSettings.height.toString()),this.trySetInputValue("minesFrequency",this._gameSettings.minesFrequency.toString()),this.trySetInputValue("selectClass",this._gameSettings.playerClass),this.trySetToggleValue("invertClicks",this._gameSettings.invertClicks),this.trySetToggleValue("removeFlags",this._gameSettings.removeFlags)}trySetInputValue(e,t){const s=document.getElementById(e);s?s.value=t:console.warn(`HTML input element with id '${e}' not found for setting value.`)}trySetToggleValue(e,t){const s=document.getElementById(e);s?s.checked=t:console.warn(`HTML input (checkbox/toggle) element with id '${e}' not found for setting value.`)}resetTimer(){this.stopTimer(),this._gameTimer=0}stopTimer(){clearInterval(this._timer)}resetHeartContainer(){const e=document.getElementById("health");e&&(e.innerHTML="")}}class d{constructor(t,s){this.modalSettings={cancelButton:!1,confirmButton:!0,showClass:!0,showClassDescription:!0,showSlot:!0,showSubTitle:!0},this.parentNode=t,this.modalSettings=Object.assign(Object.assign({},this.modalSettings),s);const i=document.getElementById("template-modal");if(!i)throw new Error("No modal-template found");this.node=i.content.cloneNode(!0),this.node=t.appendChild(this.node),this.setCancelAction(),this.parseModalSettings(),this.setClassTitle(e.playerClass),this.addEventListener()}destroyModal(){var e;null===(e=document.getElementById("modal-bg"))||void 0===e||e.remove()}parseModalSettings(){var e,t,s,i,a,l;this.modalSettings.cancelButton||null===(e=document.getElementById("modal-cancel"))||void 0===e||e.remove(),this.modalSettings.confirmButton||null===(t=document.getElementById("modal-confirm"))||void 0===t||t.remove(),this.modalSettings.title&&this.setTitle(this.modalSettings.title),this.modalSettings.subtitle&&this.setSubTitle(this.modalSettings.subtitle),this.modalSettings.text&&this.setText(this.modalSettings.text),this.modalSettings.showClass||null===(s=document.getElementById("modal-class"))||void 0===s||s.remove(),this.modalSettings.showClassDescription||null===(i=document.getElementById("modal-classDescription"))||void 0===i||i.remove(),this.modalSettings.showSlot||null===(a=document.getElementById("modal-slot"))||void 0===a||a.remove(),this.modalSettings.showSubTitle||null===(l=document.getElementById("modal-subtitle"))||void 0===l||l.remove()}setSubTitle(e){const t=document.getElementById("modal-subtitle");t&&(t.innerText=e)}setTitle(e){const t=document.getElementById("modal-title");t&&(t.innerText=e)}setClassTitle(e){const t=document.getElementById("modal-class");t&&(t.innerText=e,this.setClassText(e))}setClassText(e){const t=document.getElementById("modal-classDescription");if(t)switch(e){case"Assassin":t.innerText="The assassin can kill Monster on his Level \n‚Ä¢ Right click on a monster on the same level to kill it without taking damage \n‚Ä¢ Right click on a lower level monster will give you 1 damage \n‚Ä¢ Opening an area with right click will give you 1 damage when the area contains a monster on the same level or higher";break;case"Warrior":t.innerText="The warrior gains hearts on level up";break;case"Paladin":t.innerText="The paladin has high health to begin with";break;case"Mage":t.innerText="The mage can throw fire balls"}}setSlotContent(e){const t=document.getElementById("modal-slot");t&&(t.innerHTML=e)}setText(e){const t=document.getElementById("modal-text");t&&(t.innerText=e)}setLeaderboardContent(e){const t=document.getElementById("modal-leaderboard");t&&(e=e.slice(0,10)).forEach((e=>{const s=document.createElement("li");s.innerText=e.toString(),t.appendChild(s)}))}setDefaultClass(){const t=this.getStoredPlayerClass()||e.playerClass,s=document.getElementById("selectClass");s&&(s.value=t,this.setClassTitle(t),this.setClassText(t))}getStoredPlayerClass(){let t=e.playerClass;const s=localStorage.getItem("instance");if(s)try{const e=JSON.parse(s);e.playerClass&&(t=e.playerClass)}catch(e){}return t}setConfirmAction(e){const t=document.getElementById("modal-confirm");t&&t.addEventListener("click",(()=>{e(),this.destroyModal()}))}setCancelAction(e){const t=document.getElementById("modal-cancel");t&&t.addEventListener("click",(()=>{e&&e(),this.destroyModal()}))}addEventListener(){new MutationObserver(((e,t)=>{const s=document.getElementById("selectClass");s&&(s.addEventListener("change",(()=>this.setClassTitle(s.value))),t.disconnect())})).observe(document.body,{childList:!0,subtree:!0})}}const m={STORAGE_KEY:"theme-preference",getCurrentTheme(){const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e).theme:"system"},getSystemTheme:()=>window.matchMedia("(prefers-color-scheme: dark)").matches,setTheme(e){const t={theme:e,systemDark:this.getSystemTheme()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),this.applyTheme()},applyTheme(){const e=this.getCurrentTheme(),t="system"===e?this.getSystemTheme():"dark"===e;document.documentElement.classList.toggle("dark",t)},initialize(){this.applyTheme(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{"system"===this.getCurrentTheme()&&this.applyTheme()}))}},g=c.getInstance(),u=document.getElementById("template-settings"),p=document.getElementById("menu"),y=document.getElementById("template-leaderboard");function v(e,t,s,i){const a=document.getElementById(e);null==a||a.addEventListener(t,s,i)}function S(e=""){E(y,"No leaderboard template found"),f(p),g.pauseTimer();const t=new d(document.body,{cancelButton:!0,confirmButton:!1,showSubTitle:!0,showClass:!1,showClassDescription:!1,showSlot:!1});t.setTitle("Leaderboard"),t.setSubTitle(e),t.setText("These are your best scores"),t.setLeaderboardContent(g.getScores()),t.setCancelAction((()=>{g.resumeTimer(),f(p)}))}function f(e,t="flex"){e&&(e.style.display=e.style.display===t?"none":t)}function b(){const e=document.getElementById("themeSelect");if(!e)return;const t=e;t.value=m.getCurrentTheme(),t.onchange=()=>m.setTheme(t.value)}function E(e,t){if(!e)throw new Error(t)}function C(){const e=document.getElementById("fireball");if(!e)return;const t=(t,s)=>{t?e.classList.add("fireball-waiting"):e.classList.remove("fireball-waiting"),s?e.classList.add("fireball-ready"):e.classList.remove("fireball-ready")},s=g.player;if("Mage"===s.className){const i=s;e.style.display="",i.isFireballModeActive?t(!0,!1):i.canCastFireball()?t(!1,!0):t(!1,!1)}else e.style.display="none",t(!1,!1)}var T;m.initialize(),b(),function(){const e=document.getElementById("fireball");if(!e)return;e.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),"Mage"!==g.player.className)return;const t=g.player;t.isFireballModeActive?t.deactivateFireballMode():t.activateFireballMode()||console.log("Fireball not ready or player cannot cast.")}))}(),function(){E(u,"No settings template found");const e=new d(document.body);e.setTitle("New Game"),e.setSubTitle("Welcome to DungeonSweeper"),e.setText("This is a more elaborate version of MineSweeper with RPG elements such as classes, leveling and different enemies. Please choose your starting configuration."),e.setSlotContent(u.innerHTML),e.setConfirmAction((()=>{f(p),g.resetGame()})),e.setDefaultClass(),b(),g.populateSettingsUIFromGameSettings()}(),g.populateSettingsUIFromGameSettings(),(T=p)&&(T.style.display="none"),v("openSettings","click",(function(){E(u,"No settings template found");const e=new d(document.body,{cancelButton:!0});e.setTitle("Game Settings"),e.setText("Please choose the settings for your next round"),e.setSlotContent(u.innerHTML),e.setConfirmAction((()=>{g.resetGame(),f(p)})),e.setCancelAction((()=>f(p))),e.setDefaultClass(),f(p),b(),g.populateSettingsUIFromGameSettings()})),v("reset","click",(()=>g.resetGame())),v("openLeaderboard","click",(()=>S())),v("debugLevelUp","click",(()=>g.player.debugGainLevel())),window.gameInstance=c.getInstance()})();